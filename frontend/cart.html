<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Cart â€” ShopSmart</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body { background: linear-gradient(180deg,#0b1220,#0f172a); color: #e6eef8; font-family: Poppins, sans-serif; margin: 0; }
    .cart-container { max-width: 900px; margin: 40px auto; background:#0b1228; padding:20px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,0.4); }
    h2{text-align:center;color:#00b4db;}
    .cart-item { display: flex; align-items: center; gap: 16px; background:#0f172a; border-radius:8px; padding:10px; margin:12px 0; }
    .cart-item img { width:90px; height:90px; object-fit:cover; border-radius:6px; background:#000; }
    .item-info { flex:1; }
    .item-info h4 { margin:0; color:#fff; }
    .item-info p { margin:4px 0; color:#9fb6c7; }
    .qty { display:flex; align-items:center; gap:8px; }
    .qty button { background:#00b4db; border:none; color:#02121a; border-radius:5px; cursor:pointer; width:28px; height:28px; font-weight:bold; }
    .remove-btn { background:#ff3b30; border:none; color:#fff; padding:6px 10px; border-radius:6px; cursor:pointer; }
    .total { text-align:right; font-size:1.2rem; margin-top:20px; color:#00e0a8; }
    .checkout-btn { display:block; width:100%; background:#00b4db; border:none; padding:12px; border-radius:8px; color:#02121a; font-weight:600; cursor:pointer; font-size:1rem; margin-top:20px; }
    .checkout-btn:hover{background:#00e0a8;}
  </style>
</head>
<body>
  <div id="header-root"></div>
  <script>fetch("components/header.html").then(r=>r.text()).then(h=>document.getElementById("header-root").innerHTML=h)</script>

  <div class="cart-container">
    <h2>ðŸ›’ My Cart</h2>
    <div id="cartItems"></div>
    <div class="total" id="cartTotal"></div>
    <button id="checkoutBtn" class="checkout-btn">Proceed to Checkout</button>
  </div>

  <script>
  if (!localStorage.getItem("token") || localStorage.getItem("role") !== "user") {
    alert("Please log in as a user!");
    window.location.href = "login.html";
  }

    const API = "http://127.0.0.1:5000/api/cart";
    const userId = localStorage.getItem("user_id");
    const cartItemsDiv = document.getElementById("cartItems");
    const cartTotalEl = document.getElementById("cartTotal");
    const checkoutBtn = document.getElementById("checkoutBtn");

    if (!userId) {
      alert("Please log in first!");
      window.location.href = "login.html";
    }

    async function loadCart() {
      const res = await fetch(`${API}/${userId}`);
      const items = await res.json();

      if (!Array.isArray(items) || items.length === 0) {
        cartItemsDiv.innerHTML = "<p>Your cart is empty.</p>";
        cartTotalEl.textContent = "";
        checkoutBtn.style.display = "none";
        return;
      }

      let total = 0;
      cartItemsDiv.innerHTML = items.map(i => {
        total += i.price * i.quantity;
        return `
          <div class="cart-item">
            <img src="assets/images/${i.category.toLowerCase()}/${i.image}" alt="${i.product_name}">
            <div class="item-info">
              <h4>${i.product_name}</h4>
              <p>â‚¹${i.price} Ã— ${i.quantity}</p>
            </div>
            <button class="remove-btn" onclick="removeFromCart(${i.product_id})">Remove</button>
          </div>
        `;
      }).join('');

      cartTotalEl.textContent = `Total: â‚¹${total.toFixed(2)}`;
      checkoutBtn.style.display = "block";
    }

    async function removeFromCart(productId) {
      await fetch(`${API}/remove`, {
        method: "DELETE",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ user_id: userId, product_id: productId })
      });
      loadCart();
      window.updateCartBadge && window.updateCartBadge();
    }

    checkoutBtn.addEventListener("click", () => {
      window.location.href = "checkout.html";
    });

    loadCart();
  </script>
</body>
</html>
